    :root{color-scheme:dark;}
    *{box-sizing:border-box;}
    body{margin:0; font-family:'Noto Sans JP',system-ui,-apple-system,'Segoe UI',sans-serif; background:#05080f; color:#eaf2ff;}
    header{padding:14px 18px; border-bottom:1px solid #162030; background:linear-gradient(180deg,#0c1420,#0a1018); box-shadow:0 12px 32px rgba(0,0,0,0.35); position:sticky; top:0; z-index:30;}
    header h1{margin:0; font-size:22px; letter-spacing:0.05em;}
    header .lead{margin:4px 0 0; font-size:13px; color:#9fb0c3;}
    :root{--map-col-width:minmax(980px,1.15fr);}
    main{display:grid; grid-template-columns: var(--map-col-width) 10px 380px; gap:0; min-height:calc(100vh - 76px); position:relative;}
    main.map-expanded{grid-template-columns: minmax(0,1.6fr) 0 0;}
    main.map-expanded aside{position:absolute; right:14px; top:90px; width:340px; max-width:40vw; max-height:calc(100vh - 120px); overflow:auto; display:block; background:rgba(6,10,18,0.92); border:1px solid #162030; box-shadow:0 18px 36px rgba(0,0,0,0.45); border-radius:14px; padding:6px 0;}
    main.map-expanded #layoutHandle{display:none;}
    #mapStage{position:relative; background:radial-gradient(circle at 20% 30%, rgba(80,140,220,0.06), transparent 40%), #060b12; overflow:hidden;}
    #canvasHost{position:absolute; inset:10px; border-radius:18px; box-shadow:0 16px 40px rgba(0,0,0,0.55); background:#050910; overflow:hidden;}
    main.map-expanded #canvasHost{inset:4px; border-radius:16px;}
    #mapOverlay{position:absolute; inset:0; padding:0 0 12px 0; z-index:10; pointer-events:none;}
    #mapOverlay > *{pointer-events:auto;}
    main.map-expanded #mapOverlay{inset:6px;}
    .floating-controls{display:flex; gap:8px; margin-bottom:8px;}
    .floating-controls button{background:#0f1b2c; border-color:#1f2c44; font-size:12px; padding:6px 10px;}
    .floating-controls #toggleExpand{font-weight:800; background:#163252;}
    .sim-control-bar{display:none; gap:8px; margin-bottom:8px;}
    main.map-expanded .sim-control-bar{display:flex; position:absolute; right:20px; top:20px; z-index:12;}
    .sim-control-bar button{padding:6px 10px; font-size:12px;}
    .layer-label{padding:8px 10px; border-radius:10px; background:rgba(24,24,28,0.48); border:1px solid rgba(34,52,74,0.7); font-weight:700; color:#d7e6ff; box-shadow:0 6px 20px rgba(0,0,0,0.25); min-width:240px; margin:0 0 8px;}
    .layer-label small{display:block; color:#8da5c7; font-weight:600; margin-top:2px;}
    .legend{padding:12px 14px; border-radius:12px; background:rgba(0,0,0,0.8); border:1px solid rgba(34,52,74,0.85); box-shadow:0 10px 26px rgba(0,0,0,0.5); min-width:260px; backdrop-filter:blur(2px);}
    #legendPanel{resize:both; overflow:auto; max-width:540px; max-height:calc(100% - 40px);}
    .legend-header{display:flex; flex-direction:column; gap:2px; margin:0 0 6px; cursor:move;}
    .legend-title{font-size:14px; font-weight:800; letter-spacing:0.04em; color:#e9f2ff;}
    .legend-sub{font-size:12px; color:#8fa6c8;}
    .legend-section{border-top:1px solid #1d2a3d; padding-top:8px; margin-top:8px;}
    .legend-section h4{margin:0 0 6px; font-size:12px; letter-spacing:0.04em; color:#c7d8f0;}
    .legend-list{list-style:none; padding:0; margin:0; display:grid; grid-template-columns:repeat(2,minmax(120px,1fr)); gap:6px;}
    .legend-list.legend-animals{grid-template-columns:1fr; gap:8px;}
    .legend-list li{display:flex; align-items:center; gap:8px; font-size:12px; color:#9fb0c3;}
    .legend-icon{width:22px; display:inline-flex; justify-content:center; align-items:center; font-size:16px;}
    .legend-species{margin-top:8px; padding-top:8px; border-top:1px dashed #1f2c44;}
    .legend-species-title{font-size:11px; color:#8fa6c8; margin-bottom:6px; letter-spacing:0.04em; text-transform:uppercase;}
    .legend-species-list{list-style:none; padding:0; margin:0; display:grid; gap:6px; grid-template-columns:repeat(auto-fill,minmax(140px,1fr));}
    .legend-species-item{display:flex; align-items:center; gap:8px; font-size:12px; color:#c9d8ec; background:rgba(12,18,30,0.6); border:1px solid #1f2c44; border-radius:10px; padding:6px 8px;}
    .legend-swatch{width:16px; height:16px; border-radius:4px; border:1px solid rgba(0,0,0,0.25); box-shadow:0 0 0 1px rgba(255,255,255,0.08); flex-shrink:0;}
    .legend-shape{width:28px; height:16px; display:grid; place-items:center; color:#dce8ff; font-size:12px; letter-spacing:0.04em; background:rgba(255,255,255,0.05); border:1px solid #203049; border-radius:6px;}
    .swatch{width:16px; height:16px; border-radius:4px; border:1px solid #2e3f57; display:inline-block;}
    .swatch.base{background:linear-gradient(135deg,#2c6a2c,#2b3d2b);} .swatch.river{background:#4da7ff;} .swatch.moist{background:linear-gradient(90deg,#2f3a70,#6fa4ff);} .swatch.plant{background:linear-gradient(135deg,#2d5f39,#5ad17f);} .swatch.herb{background:#a7f18c; border:1px solid #f5ffe7; box-shadow:0 0 0 1px #0b0f18;} .swatch.carn{background:#ffad7d; border:1px solid #fff2e7; box-shadow:0 0 0 1px #0b0f18;}
    .legend-filter{list-style:none; padding:0; margin:4px 0 0; display:flex; flex-direction:column; gap:6px;}
    .filter-pill{display:flex; justify-content:space-between; align-items:center; padding:8px 10px; border-radius:10px; border:1px solid #203049; background:linear-gradient(90deg, rgba(50,86,140,0.25), rgba(80,180,150,0.25)); color:#cfe4ff; font-size:12px; letter-spacing:0.02em; box-shadow:0 6px 16px rgba(0,0,0,0.28);}
    .filter-pill strong{color:#ffffff;}
    .filter-pill:not(.active){opacity:0.55; filter:saturate(0.5);}
    #mapStage canvas{display:block; width:100%; height:100%;}
    #renderAlert{position:absolute; left:18px; bottom:18px; background:rgba(60,12,12,0.85); border:1px solid rgba(255,120,120,0.4); padding:10px 12px; border-radius:12px; font-weight:700; color:#ffb4b4; z-index:5; display:none;}
    #terrainToolbar{position:absolute; left:16px; bottom:16px; display:flex; gap:10px; align-items:center; background:rgba(8,12,18,0.88); border:1px solid #1f2c44; border-radius:12px; padding:8px 10px; box-shadow:0 10px 20px rgba(0,0,0,0.4); z-index:8;}
    #terrainToolbar label{gap:4px;}
    #terrainToolbar .hint{font-size:11px; color:#9fb0c3;}
    #terrainToolbar button.active{background:#1f4b2f; border-color:#2d6d42;}
    aside{background:#0b1018; border-left:1px solid #162030; display:flex; flex-direction:column;}
    .panel{padding:12px 14px; border-bottom:1px solid #162030;}
    .panel h2{margin:0 0 6px; font-size:16px; letter-spacing:0.04em; position:relative; padding-left:6px;}
    .panel h2::before{content:''; position:absolute; left:0; top:50%; width:4px; height:70%; transform:translateY(-50%); background:linear-gradient(180deg,#5ad17f,#5fa4ff); border-radius:6px;}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    button, select, input[type="number"], input[type="text"], input[type="range"]{border-radius:10px; border:1px solid #243447; background:#111b29; color:#eaf2ff; padding:8px 10px; font-size:14px;}
    input[type="range"]{padding:0; height:8px;}
    button.primary{background:#1d3b62; border-color:#2a4f80; font-weight:700;} button.danger{background:#3a1823; border-color:#5a2434;} button:disabled{opacity:0.5; cursor:not-allowed;}
    label{font-size:13px; color:#c6d2e0; display:flex; gap:6px; align-items:center;}
    details{border:1px solid #1b283a; border-radius:12px; padding:6px 8px; background:#0f1622;}
    details summary{cursor:pointer; font-weight:700; color:#c9d8ec; list-style:none;}
    .hud-grid{display:grid; grid-template-columns:repeat(2,minmax(120px,1fr)); gap:8px;}
    .hud{border:1px solid #1b283a; border-radius:12px; padding:10px 12px; background:#0f1622;}
    .hud .label{font-size:12px; color:#98abc5;} .hud .value{font-size:20px; font-weight:800;}
    .chart-wrap{background:#0f1622; border:1px solid #1b283a; border-radius:12px; padding:10px;}
    .overlay-toggle{display:grid; gap:6px; grid-template-columns: repeat(auto-fit, minmax(140px,1fr));}
    .log-box{height:120px; overflow:auto; font-size:12px; background:#0b111b; border:1px solid #1b283a; border-radius:10px; padding:8px;}
    .badge{display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; background:#122039; border:1px solid #243447; font-size:12px; color:#9fb0c3; gap:6px;}
    .pill-row label.pill{padding:8px 10px; border:1px solid #1f2c44; border-radius:12px; background:rgba(16,24,38,0.8); gap:6px; cursor:pointer; box-shadow:0 4px 14px rgba(0,0,0,0.25); font-weight:700; letter-spacing:0.02em;}
    .pill-row label.pill input{accent-color:#5ad17f;}
    .flex-between{display:flex; justify-content:space-between; align-items:center; gap:12px;}
    .floating-window{position:absolute; right:12px; top:12px; background:#0e1625; border:1px solid #22344a; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,0.45); padding:10px; width:300px; cursor:move;}
    .hidden{display:none;}
    body.hud-hidden .hud-panel{display:none;}
    #cellTooltip{position:absolute; pointer-events:none; padding:8px 10px; border-radius:10px; background:rgba(12,18,28,0.9); border:1px solid #22344a; font-size:12px; color:#d7e6ff; z-index:20; white-space:pre;}
    .draggable-panel{position:absolute; cursor:move; top:12px; left:12px; user-select:none; touch-action:none;}
    .draggable-panel h3{cursor:move;}
    #trophicPanel{resize:both; overflow:auto; max-width:420px; max-height:calc(100% - 60px);}
    #layoutHandle{cursor:col-resize; background:linear-gradient(180deg, rgba(45,75,120,0.8), rgba(80,140,200,0.4)); width:100%; height:100%; min-height:100%;}
    #layoutHandle::after{content:''; display:block; margin:0 auto; width:4px; height:36px; background:rgba(255,255,255,0.25); border-radius:2px;}
    main.resizing #layoutHandle{background:linear-gradient(180deg, rgba(90,160,120,0.6), rgba(120,220,160,0.5));}

    .mutation-map{display:grid; gap:8px; background:#0f1622; border:1px solid #1b283a; border-radius:12px; padding:10px;}
    .mutation-row{display:grid; gap:6px; grid-template-columns:1fr; background:#0b111d; border:1px solid #1b283a; border-radius:10px; padding:8px 10px;}
    .mutation-head{display:flex; justify-content:space-between; align-items:center; font-weight:700; color:#dce8ff;}
    .gene-bars{display:grid; gap:6px; grid-template-columns:repeat(auto-fit,minmax(150px,1fr));}
    .gene-bar{position:relative; padding:6px 8px; border-radius:8px; background:linear-gradient(90deg, rgba(70,130,200,0.14), rgba(120,210,140,0.18)); border:1px solid #1c2a3f; color:#cde2ff; font-size:12px;}
    .gene-bar::after{content:''; position:absolute; left:8px; right:8px; bottom:6px; height:4px; border-radius:999px; background:var(--bar-color, #5ad17f); opacity:0.75;}
    .gene-bar strong{display:block; font-size:13px; color:#e8f3ff; margin-bottom:2px;}
    .mut-hint{margin-top:6px; font-size:12px; color:#8fa6c8;}
    .mut-subtle{margin-top:4px; font-size:11px; color:#6f88aa;}
    .legend-hint{margin-top:8px; font-size:12px; color:#94a8c4; background:linear-gradient(90deg, rgba(50,80,130,0.25), rgba(80,200,140,0.2)); border:1px solid #1f2c44; border-radius:10px; padding:8px 10px;}
    .legend-hint.subtle{background:linear-gradient(90deg, rgba(30,50,80,0.4), rgba(30,90,80,0.35)); color:#9fb0c3;}

    #inspector.inspector-panel{margin-top:8px; border:1px solid #1f2c44; background:#0c111d; border-radius:6px; padding:10px; color:#dfe9ff; font-size:13px; display:grid; gap:6px;}
    .inspector-heading{font-weight:700; color:#ffffff; letter-spacing:0.02em;}
    .inspector-heading small{color:#8ba0c5; font-weight:400;}
    .inspector-row{display:flex; justify-content:space-between; gap:8px; align-items:center;}
    .inspector-row span:first-child{color:#9fb0c3; font-size:12px;}
    .inspector-row span:last-child{color:#e9f2ff; font-weight:600; text-align:right;}
    .inspector-row.genetics span:last-child{font-size:12px; line-height:1.4; font-weight:500; color:#cde7ff;}
    .inspector-subhead{font-size:12px; color:#8fa6c8; font-weight:700; letter-spacing:0.02em; margin-top:4px;}
    .inspector-row.timeline{font-size:11px; color:#cfe0fa;}
    .inspector-row.timeline span:first-child{color:#7ea2ff;}
    .inspector-empty{color:#8fa6c8; font-size:12px; text-align:center; padding:6px 0;}
    .mini-map-panel{padding:12px 14px; border-radius:12px; background:rgba(10,16,26,0.9); border:1px solid #1f2c44; box-shadow:0 12px 26px rgba(0,0,0,0.45); min-width:220px;}
    .mini-map-panel h3{margin:0 0 6px; font-size:13px; letter-spacing:0.03em; color:#dce8ff;}
    .mini-map-panel .legend-sub{margin:0 0 8px;}
    .trophic-bars{display:grid; gap:6px;}
    .trophic-row{display:grid; grid-template-columns:60px 1fr 60px; gap:6px; align-items:center; font-size:12px; color:#cde2ff;}
    .trophic-bar{position:relative; height:10px; border-radius:999px; background:#0a131f; border:1px solid #1f2c44; overflow:hidden;}
    .trophic-bar span{position:absolute; inset:0; display:block; border-radius:999px;}
    .trophic-fill.herb{background:linear-gradient(90deg,#3fbf7f,#7de3a8);}
    .trophic-fill.carn{background:linear-gradient(90deg,#c05a4f,#ff9f7d);}
    .trophic-fill.omn{background:linear-gradient(90deg,#5a7bc0,#9fb9ff);}

    .gene-guide{margin-top:6px; display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:6px;}
    .gene-guide__item{background:rgba(16,24,38,0.85); border:1px solid #1f2c44; border-radius:10px; padding:8px 10px; font-size:12px; color:#cfe0fa; box-shadow:0 6px 16px rgba(0,0,0,0.25);}
    .gene-guide__item strong{color:#e8f3ff;}
    .gene-note{margin-top:6px; font-size:12px; color:#9fb0c3; background:linear-gradient(90deg, rgba(80,140,200,0.12), rgba(90,210,150,0.14)); border:1px solid #1f2c44; border-radius:12px; padding:10px;}
    .species-card{border:1px solid #1f2c44; border-radius:14px; padding:10px 12px; background:linear-gradient(180deg, rgba(13,19,30,0.92), rgba(8,12,20,0.94)); box-shadow:0 8px 22px rgba(0,0,0,0.38);}
    .species-card__header{display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center; padding-bottom:6px; border-bottom:1px dashed #1f2c44;}
    .species-avatar{width:36px; height:36px; border-radius:12px; display:grid; place-items:center; font-size:18px; font-weight:800; color:#0b0f18; box-shadow:0 0 0 2px rgba(0,0,0,0.2);} 
    .species-card__title{font-size:15px; font-weight:800; letter-spacing:0.03em;}
    .species-card__meta{font-size:12px; color:#8fa6c8;}
    .species-card__count{display:flex; gap:6px; flex-wrap:wrap; align-items:center; justify-content:flex-end;}
    .gene-lines{display:grid; gap:8px; padding:8px 4px;}
    .gene-line{display:grid; grid-template-columns:120px 1fr 60px; align-items:center; gap:8px; background:rgba(18,26,38,0.7); border:1px solid #1b283a; border-radius:10px; padding:8px 10px;}
    .gene-label{font-weight:700; color:#dfe9ff; font-size:12px; letter-spacing:0.02em;}
    .gene-meter{height:6px; background:#0b111b; border-radius:999px; overflow:hidden; border:1px solid #1f2c44;}
    .gene-meter span{display:block; height:100%; background:linear-gradient(90deg,#5ad17f,#7dc4ff); border-radius:999px;}
    .gene-value{text-align:right; font-weight:700; color:#e8f3ff; font-size:12px;}
    .gene-desc{grid-column:1/-1; font-size:11px; color:#8fa6c8;}
    .species-editor-detail{margin-top:6px; border:1px solid #1b283a; border-radius:10px; background:#0f1622; padding:6px 8px;}
    .species-editor-detail summary{font-weight:700; color:#dfe9ff; cursor:pointer;}
    @media(max-width:1100px){ .gene-line{grid-template-columns:1fr; grid-template-rows:auto auto auto auto;} .gene-value{justify-self:flex-start;} }

    .hazard-panel{margin-top:10px; border:1px solid #2a3a52; border-radius:12px; background:linear-gradient(180deg, rgba(30,45,70,0.8), rgba(20,28,42,0.9)); padding:10px;}
    .hazard-title{font-weight:800; font-size:13px; letter-spacing:0.03em; color:#e8f3ff; display:flex; gap:8px; align-items:center; margin:0 0 6px;}
    .hazard-desc{font-size:12px; color:#9fb0c3; margin:0;}
    .badge.hazard{background:#2b1f30; border-color:#50344b; color:#ffb4c8;}
