    :root{color-scheme:dark;}
    *{box-sizing:border-box;}
    body{margin:0; font-family:'Noto Sans JP',system-ui,-apple-system,'Segoe UI',sans-serif; background:#05080f; color:#eaf2ff;}
    header{padding:14px 18px; border-bottom:1px solid #162030; background:linear-gradient(180deg,#0c1420,#0a1018); box-shadow:0 12px 32px rgba(0,0,0,0.35); position:sticky; top:0; z-index:30;}
    header h1{margin:0; font-size:22px; letter-spacing:0.05em;}
    header .lead{margin:4px 0 0; font-size:13px; color:#9fb0c3;}
    main{display:grid; grid-template-columns: 1fr 380px; gap:0; min-height:calc(100vh - 76px);}    
    #mapStage{position:relative; background:radial-gradient(circle at 20% 30%, rgba(80,140,220,0.06), transparent 40%), #060b12; overflow:hidden;}
    #canvasHost{position:absolute; inset:12px; border-radius:18px; box-shadow:0 16px 40px rgba(0,0,0,0.55); background:#050910; overflow:hidden;}
    #mapOverlay{position:absolute; left:20px; top:20px; display:flex; flex-direction:column; gap:10px; z-index:10;}
    .layer-label{padding:8px 10px; border-radius:10px; background:rgba(15,22,34,0.86); border:1px solid #22344a; font-weight:700; color:#d7e6ff; box-shadow:0 6px 20px rgba(0,0,0,0.45); min-width:240px;}
    .layer-label small{display:block; color:#8da5c7; font-weight:600; margin-top:2px;}
    .legend{padding:10px 12px; border-radius:12px; background:rgba(12,18,28,0.86); border:1px solid #22344a; box-shadow:0 6px 20px rgba(0,0,0,0.45); min-width:240px;}
    .legend h3{margin:0 0 8px; font-size:13px; letter-spacing:0.03em; color:#c7d8f0;}
    .legend ul{list-style:none; padding:0; margin:0; display:grid; grid-template-columns:repeat(2,minmax(110px,1fr)); gap:6px;}
    .legend li{display:flex; align-items:center; gap:8px; font-size:12px; color:#9fb0c3;}
    .swatch{width:16px; height:16px; border-radius:4px; border:1px solid #2e3f57; display:inline-block;}
    .swatch.base{background:linear-gradient(135deg,#2c6a2c,#2b3d2b);} .swatch.river{background:#4da7ff;} .swatch.moist{background:linear-gradient(90deg,#2f3a70,#6fa4ff);} .swatch.plant{background:linear-gradient(135deg,#2d5f39,#5ad17f);} .swatch.herb{background:#a7f18c; border:1px solid #f5ffe7; box-shadow:0 0 0 1px #0b0f18;} .swatch.carn{background:#ffad7d; border:1px solid #fff2e7; box-shadow:0 0 0 1px #0b0f18;}
    #mapStage canvas{display:block; width:100%; height:100%;}
    #renderAlert{position:absolute; left:18px; bottom:18px; background:rgba(60,12,12,0.85); border:1px solid rgba(255,120,120,0.4); padding:10px 12px; border-radius:12px; font-weight:700; color:#ffb4b4; z-index:5; display:none;}
    aside{background:#0b1018; border-left:1px solid #162030; display:flex; flex-direction:column;}
    .panel{padding:12px 14px; border-bottom:1px solid #162030;}
    .panel h2{margin:0 0 6px; font-size:16px; letter-spacing:0.04em;}
    .row{display:flex; gap:8px; flex-wrap:wrap; align-items:center;}
    button, select, input[type="number"], input[type="text"], input[type="range"]{border-radius:10px; border:1px solid #243447; background:#111b29; color:#eaf2ff; padding:8px 10px; font-size:14px;}
    input[type="range"]{padding:0; height:8px;}
    button.primary{background:#1d3b62; border-color:#2a4f80; font-weight:700;} button.danger{background:#3a1823; border-color:#5a2434;} button:disabled{opacity:0.5; cursor:not-allowed;}
    label{font-size:13px; color:#c6d2e0; display:flex; gap:6px; align-items:center;}
    details{border:1px solid #1b283a; border-radius:12px; padding:6px 8px; background:#0f1622;}
    details summary{cursor:pointer; font-weight:700; color:#c9d8ec; list-style:none;}
    .hud-grid{display:grid; grid-template-columns:repeat(2,minmax(120px,1fr)); gap:8px;}
    .hud{border:1px solid #1b283a; border-radius:12px; padding:10px 12px; background:#0f1622;}
    .hud .label{font-size:12px; color:#98abc5;} .hud .value{font-size:20px; font-weight:800;}
    .chart-wrap{background:#0f1622; border:1px solid #1b283a; border-radius:12px; padding:10px;}
    .overlay-toggle{display:grid; gap:6px; grid-template-columns: repeat(auto-fit, minmax(140px,1fr));}
    .log-box{height:120px; overflow:auto; font-size:12px; background:#0b111b; border:1px solid #1b283a; border-radius:10px; padding:8px;}
    .badge{display:inline-flex; align-items:center; padding:4px 8px; border-radius:999px; background:#122039; border:1px solid #243447; font-size:12px; color:#9fb0c3; gap:6px;}
    .flex-between{display:flex; justify-content:space-between; align-items:center; gap:12px;}
    .floating-window{position:absolute; right:12px; top:12px; background:#0e1625; border:1px solid #22344a; border-radius:14px; box-shadow:0 12px 30px rgba(0,0,0,0.45); padding:10px; width:300px; cursor:move;}
    .hidden{display:none;}
    #cellTooltip{position:absolute; pointer-events:none; padding:8px 10px; border-radius:10px; background:rgba(12,18,28,0.9); border:1px solid #22344a; font-size:12px; color:#d7e6ff; z-index:20; white-space:pre;}
    .draggable-panel{position:absolute; cursor:move; top:76px; left:0; user-select:none; touch-action:none;}
    .draggable-panel h3{cursor:move;}
